% load frames
load('../data/carseq.mat')
[H W T] = size(frames);

% implementation
rect = [60; 117; 146; 152];
target = [2 100 200 300 400];
rects = zeros(T, 4);

for i = 2: T
    % compute u, v vector and update 
    [prev, curr] = deal(squeeze(frames(:,:,i-1)), squeeze(frames(:,:,i)));
    [u,v] = LucasKanadeInverseCompositional(prev, curr, rect);
    rect = rect + [u; v; u; v];
    rects(i, :) = rect;
    
    % report the frame and rectange if it's the target
    if ~isempty(find(target == i))
        img = insertShape(curr, 'Rectangle', rect', 'LineWidth', 5);
        imshow(img);
        title(sprintf('Frame %d', i));
        save()
    end 
    
end



% save the rects
save carseqrects.mat rects
